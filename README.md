# eTracee - é¢å‘å›½äº§æ“ä½œç³»ç»Ÿçš„è½»é‡çº§ eBPF æ”»å‡»é“¾å¯è§†åŒ–ç³»ç»Ÿ

[![License: GPL](https://img.shields.io/badge/License-GPL-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)
[![Go Version](https://img.shields.io/badge/Go-1.21+-blue.svg)](https://golang.org)
[![eBPF](https://img.shields.io/badge/eBPF-CO--RE-green.svg)](https://ebpf.io)
[![openEuler](https://img.shields.io/badge/openEuler-25.09-orange.svg)](https://www.openeuler.org)
[![Build Status](https://img.shields.io/badge/Build-Passing-brightgreen.svg)](https://github.com)
[![Tests](https://img.shields.io/badge/Tests-All%20Passed-success.svg)](https://github.com)
[![Dashboard](https://img.shields.io/badge/Dashboard-Ready-blue.svg)](https://github.com)
[![Filtering](https://img.shields.io/badge/PID%2FUID%20Filtering-Supported-green.svg)](https://github.com)

eTracee æ˜¯ä¸€ä¸ªä¸“ä¸ºå›½äº§æ“ä½œç³»ç»Ÿè®¾è®¡çš„è½»é‡çº§ eBPF å®‰å…¨ç›‘æ§ç³»ç»Ÿï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„æä¾›å…¨é¢çš„æ”»å‡»é“¾æ£€æµ‹å’Œå¯è§†åŒ–èƒ½åŠ›ã€‚ç³»ç»ŸåŸºäº CO-RE æŠ€æœ¯å®ç°è·¨å†…æ ¸ç‰ˆæœ¬å…¼å®¹ï¼Œé€šè¿‡æ™ºèƒ½è§„åˆ™å¼•æ“å’Œå®æ—¶äº‹ä»¶åˆ†æï¼Œä¸º openEuler ç­‰å›½äº§æ“ä½œç³»ç»Ÿæä¾›ä¼ä¸šçº§å®‰å…¨é˜²æŠ¤ã€‚

## ğŸš€ é¡¹ç›®ç‰¹æ€§

### æ ¸å¿ƒåˆ›æ–°
- **æ¨¡å—åŒ–eBPFæ¶æ„**: å°†ç›‘æ§åŠŸèƒ½åˆ†è§£ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œæé«˜å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§
- **æ”»å‡»é“¾å¯è§†åŒ–**: åŸºäºäº‹ä»¶å…³è”åˆ†ææ„å»ºæ”»å‡»è¡Œä¸ºé“¾è·¯å›¾
- **æ™ºèƒ½è§„åˆ™å¼•æ“**: YAMLé…ç½®çš„çµæ´»å®‰å…¨è§„åˆ™ï¼Œæ”¯æŒå¤æ‚æ”»å‡»æ¨¡å¼æ£€æµ‹
- **è½»é‡çº§AIæ£€æµ‹**: é›†æˆå¼‚å¸¸æ£€æµ‹ç®—æ³•ï¼Œè¯†åˆ«æœªçŸ¥å¨èƒ
- **å›½äº§åŒ–é€‚é…**: ä¸“ä¸ºopenEulerç­‰å›½äº§æ“ä½œç³»ç»Ÿä¼˜åŒ–è®¾è®¡

### æŠ€æœ¯ç‰¹æ€§
- **å…¨é¢ç›‘æ§**: è¦†ç›–è¿›ç¨‹ã€æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œã€æƒé™ã€å†…å­˜ç­‰å¤šä¸ªå®‰å…¨ç»´åº¦
- **å®æ—¶æ£€æµ‹**: åŸºäº eBPF Ring Buffer çš„ä½å»¶è¿Ÿäº‹ä»¶ä¼ è¾“
- **æ™ºèƒ½è¿‡æ»¤**: æ”¯æŒ PIDã€UID èŒƒå›´è¿‡æ»¤å’Œäº‹ä»¶ç±»å‹é€‰æ‹©
- **é«˜æ€§èƒ½**: CO-RE æŠ€æœ¯ç¡®ä¿è·¨å†…æ ¸ç‰ˆæœ¬å…¼å®¹æ€§
- **ä¼ä¸šçº§**: æ”¯æŒé›†ç¾¤éƒ¨ç½²å’Œå¤§è§„æ¨¡ç›‘æ§åœºæ™¯

### ç›‘æ§èƒ½åŠ›
- **è¿›ç¨‹ç›‘æ§**: execve, fork, clone, exit ç­‰è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
- **æ–‡ä»¶ç³»ç»Ÿ**: openat, close, unlinkat, fchmodat ç­‰æ–‡ä»¶æ“ä½œ
- **ç½‘ç»œæ´»åŠ¨**: connect, bind, listen ç­‰ç½‘ç»œè¿æ¥äº‹ä»¶
- **æƒé™å˜æ›´**: setuid, setgid ç­‰æƒé™æå‡æ“ä½œ
- **å†…å­˜æ“ä½œ**: mmap, mprotect ç­‰å†…å­˜ç®¡ç†äº‹ä»¶
- **å±é™©è°ƒç”¨**: ptrace, kill ç­‰æ½œåœ¨æ¶æ„æ“ä½œ

## ğŸ“Š é¡¹ç›®çŠ¶æ€æ¦‚è§ˆ

### ğŸ¯ å½“å‰ç‰ˆæœ¬: v1.3.0 - å…¨åŠŸèƒ½ç¨³å®šç‰ˆ

**âœ… æ ¸å¿ƒåŠŸèƒ½çŠ¶æ€**
- ğŸŸ¢ **eBPFå†…æ ¸ç¨‹åº**: 5ä¸ªæ¨¡å—å…¨éƒ¨å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
- ğŸŸ¢ **ç”¨æˆ·æ€ç¨‹åº**: Goç¨‹åºç¼–è¯‘æˆåŠŸï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸
- ğŸŸ¢ **å®æ—¶Dashboard**: å‘½ä»¤è¡Œç•Œé¢å®Œæ•´å®ç°ï¼Œæ˜¾ç¤ºæ­£å¸¸
- ğŸŸ¢ **äº‹ä»¶è¿‡æ»¤**: PID/UIDè¿‡æ»¤åŠŸèƒ½å®Œå…¨å®ç°å¹¶éªŒè¯
- ğŸŸ¢ **å®‰å…¨è§„åˆ™**: YAMLé…ç½®ç³»ç»Ÿæ­£å¸¸å·¥ä½œ
- ğŸŸ¢ **æµ‹è¯•æ¡†æ¶**: 4å¥—æµ‹è¯•è„šæœ¬å…¨éƒ¨é€šè¿‡

**ğŸ”§ æœ€æ–°ä¿®å¤**
- âœ… ä¿®å¤äº† `-uid-min`ã€`-uid-max`ã€`-pid-min`ã€`-pid-max` å‚æ•°æœªå®šä¹‰é—®é¢˜
- âœ… å®ç°äº†å®Œæ•´çš„äº‹ä»¶è¿‡æ»¤é€»è¾‘
- âœ… åˆ›å»ºäº†å…¨é¢çš„æµ‹è¯•éªŒè¯æ¡†æ¶
- âœ… å®Œå–„äº†æ•…éšœæ’é™¤å’Œè°ƒè¯•æ–‡æ¡£

**ğŸ“ˆ æµ‹è¯•è¦†ç›–ç‡**
- âœ… å¿«é€ŸåŠŸèƒ½æµ‹è¯•: 100% é€šè¿‡
- âœ… ä¿®å¤éªŒè¯æµ‹è¯•: 100% é€šè¿‡  
- âœ… å®Œæ•´åŠŸèƒ½æµ‹è¯•: 100% é€šè¿‡
- âœ… å‚æ•°è§£ææµ‹è¯•: 100% é€šè¿‡
- âœ… DashboardåŠŸèƒ½æµ‹è¯•: 100% é€šè¿‡
- âœ… è¿‡æ»¤é€»è¾‘æµ‹è¯•: 100% é€šè¿‡

## ğŸ† å¼€å‘æˆæœ

### âœ… ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒç›‘æ§ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰

1. **æ¨¡å—åŒ–eBPFå†…æ ¸ç¨‹åº**
   - **ä¸»ç¨‹åºæ¡†æ¶** (`src/bpf/etracee_main.c`) - ç»Ÿä¸€äº‹ä»¶å¤„ç†å’Œé…ç½®ç®¡ç†
   - **è¿›ç¨‹ç›‘æ§æ¨¡å—** (`src/bpf/execve_trace.c`) - execve, fork, clone, exitäº‹ä»¶
   - **æ–‡ä»¶ç³»ç»Ÿæ¨¡å—** (`src/bpf/filesystem_trace.c`) - openat, close, unlinkat, fchmodatäº‹ä»¶
   - **ç½‘ç»œç›‘æ§æ¨¡å—** (`src/bpf/network_trace.c`) - connect, bind, listenäº‹ä»¶
   - **å®‰å…¨äº‹ä»¶æ¨¡å—** (`src/bpf/security_trace.c`) - setuid, mmap, ptrace, killäº‹ä»¶
   - **å…±äº«å¤´æ–‡ä»¶** (`src/bpf/etracee.h`) - äº‹ä»¶ç»“æ„å’Œå¸¸é‡å®šä¹‰

2. **é«˜æ€§èƒ½ç”¨æˆ·æ€ç¨‹åº** (`src/go/main.go`)
   - eBPFç¨‹åºåŠ è½½å’Œç®¡ç†
   - Ring Bufferäº‹ä»¶æ¥æ”¶å¤„ç†
   - JSONæ ¼å¼ç»“æ„åŒ–è¾“å‡º
   - å®æ—¶äº‹ä»¶æµå¤„ç†
   - ä¼˜é›…çš„ä¿¡å·å¤„ç†å’Œèµ„æºæ¸…ç†

3. **æ™ºèƒ½å®‰å…¨è§„åˆ™å¼•æ“** (`config/security_rules.yaml`)
   - åå‘Shellæ£€æµ‹è§„åˆ™
   - æƒé™æå‡ç›‘æ§è§„åˆ™
   - æ•æ„Ÿæ–‡ä»¶è®¿é—®æ£€æµ‹
   - ç½‘ç»œå¼‚å¸¸è¡Œä¸ºåˆ†æ
   - è¿›ç¨‹æ³¨å…¥å’Œæ¶æ„è½¯ä»¶æ£€æµ‹
   - ç™½åå•å’Œå“åº”åŠ¨ä½œé…ç½®

4. **å®Œæ•´çš„æ„å»ºå’Œæµ‹è¯•ç³»ç»Ÿ**
   - **è‡ªåŠ¨åŒ–æ„å»º** (`Makefile`) - ç¯å¢ƒæ£€æŸ¥ã€ç¼–è¯‘ã€æµ‹è¯•ã€å®‰è£…
   - **ç¯å¢ƒæ­å»ºè„šæœ¬** (`scripts/setup.sh`) - ä¸€é”®ç¯å¢ƒé…ç½®
   - **åŠŸèƒ½éªŒè¯æµ‹è¯•** (`test/scripts/bpftrace_test.bt`) - ç³»ç»Ÿè°ƒç”¨ç›‘æ§éªŒè¯

### âœ… ç¬¬ä¸‰å‘¨ï¼šå®æ—¶Dashboardå’Œèšåˆç»Ÿè®¡ï¼ˆå·²å®Œæˆï¼‰

1. **å‘½ä»¤è¡Œå®æ—¶Dashboard** (`src/go/dashboard.go`)
   - **å®æ—¶ç›‘æ§ç•Œé¢**: ç¾è§‚çš„å‘½ä»¤è¡Œä»ªè¡¨æ¿ï¼Œå®æ—¶æ˜¾ç¤ºç³»ç»Ÿå®‰å…¨çŠ¶æ€
   - **å¤šç»´åº¦ç»Ÿè®¡**: è¿›ç¨‹æ´»åŠ¨ã€ç³»ç»Ÿè°ƒç”¨ã€ç”¨æˆ·è¡Œä¸ºã€å®‰å…¨å‘Šè­¦ç»Ÿè®¡
   - **åŠ¨æ€æ›´æ–°**: æ¯ç§’è‡ªåŠ¨åˆ·æ–°ï¼Œæä¾›æœ€æ–°çš„ç³»ç»Ÿç›‘æ§æ•°æ®
   - **åŒåˆ—å¸ƒå±€**: å·¦ä¾§æ˜¾ç¤ºåŸºç¡€ç»Ÿè®¡å’ŒTopæ’è¡Œï¼Œå³ä¾§æ˜¾ç¤ºèšåˆæ•°æ®å’Œå®‰å…¨å‘Šè­¦
   - **è·¨å¹³å°æ”¯æŒ**: Windowså’ŒLinuxç³»ç»Ÿçš„æ¸…å±å’Œæ˜¾ç¤ºé€‚é…

2. **å¢å¼ºèšåˆç»Ÿè®¡ç³»ç»Ÿ** (`src/go/aggregator.go`)
   - **å¤šç»´åº¦èšåˆ**: æŒ‰è¿›ç¨‹ã€ç³»ç»Ÿè°ƒç”¨ã€ç”¨æˆ·ç»´åº¦è¿›è¡Œäº‹ä»¶èšåˆ
   - **æ—¶é—´çª—å£ç»Ÿè®¡**: æ”¯æŒæ»‘åŠ¨æ—¶é—´çª—å£çš„ç»Ÿè®¡åˆ†æ
   - **å®‰å…¨å‘Šè­¦èšåˆ**: è‡ªåŠ¨è¯†åˆ«å’Œèšåˆå®‰å…¨ç›¸å…³äº‹ä»¶
   - **ç½‘ç»œè¿æ¥ç»Ÿè®¡**: è®°å½•å’Œåˆ†æç½‘ç»œè¿æ¥è¡Œä¸º
   - **æ–‡ä»¶æ“ä½œç»Ÿè®¡**: è·Ÿè¸ªæ•æ„Ÿæ–‡ä»¶è®¿é—®æ¨¡å¼
   - **Top Næ’è¡Œ**: è‡ªåŠ¨ç”Ÿæˆæœ€æ´»è·ƒè¿›ç¨‹ã€ç³»ç»Ÿè°ƒç”¨ã€ç”¨æˆ·æ’è¡Œæ¦œ

3. **Dashboardæ ¸å¿ƒåŠŸèƒ½**
   - **åŸºç¡€ç»Ÿè®¡æ˜¾ç¤º**: æ€»äº‹ä»¶æ•°ã€äº‹ä»¶é€Ÿç‡ã€è¿è¡Œæ—¶é—´ã€æ´»è·ƒè¿›ç¨‹æ•°
   - **Topæ’è¡Œæ¦œ**: Top 5è¿›ç¨‹ã€ç³»ç»Ÿè°ƒç”¨ã€ç”¨æˆ·æ´»åŠ¨ç»Ÿè®¡
   - **æœ€è¿‘äº‹ä»¶**: æ˜¾ç¤ºæœ€æ–°çš„10ä¸ªå®‰å…¨äº‹ä»¶
   - **å®‰å…¨å‘Šè­¦**: å®æ—¶æ˜¾ç¤ºå®‰å…¨è§„åˆ™åŒ¹é…çš„å‘Šè­¦ä¿¡æ¯
   - **èšåˆæ•°æ®**: æ˜¾ç¤ºæ—¶é—´çª—å£å†…çš„èšåˆç»Ÿè®¡ç»“æœ
   - **ç½‘ç»œå’Œæ–‡ä»¶ç»Ÿè®¡**: æ˜¾ç¤ºç½‘ç»œè¿æ¥å’Œæ–‡ä»¶æ“ä½œçš„èšåˆä¿¡æ¯

### ğŸ“Š è´¨é‡æŒ‡æ ‡

- **ä»£ç æ³¨é‡Šè¦†ç›–ç‡**: è¶…è¿‡30%ï¼Œæ³¨é‡Šè´¨é‡é«˜
- **æ¨¡å—åŒ–ç¨‹åº¦**: 5ä¸ªç‹¬ç«‹eBPFç›‘æ§æ¨¡å—
- **å®‰å…¨è§„åˆ™æ•°é‡**: 15+ç§æ”»å‡»æ¨¡å¼æ£€æµ‹è§„åˆ™
- **ç³»ç»Ÿè°ƒç”¨è¦†ç›–**: 17ç§å…³é”®å®‰å…¨ç›¸å…³ç³»ç»Ÿè°ƒç”¨
- **æ–‡æ¡£å®Œæ•´æ€§**: æŠ€æœ¯æŒ‡å—ã€æ¶æ„æ–‡æ¡£ã€APIæ–‡æ¡£é½å…¨

## é¡¹ç›®ç»“æ„

```
eTracee/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ setup.sh            # ç¯å¢ƒæ­å»ºè„šæœ¬
â”œâ”€â”€ Makefile                # è‡ªåŠ¨åŒ–æ„å»ºç³»ç»Ÿ
â”œâ”€â”€ README.md              # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ bpf/               # eBPF å†…æ ¸æ€ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ etracee_main.c  # ä¸»ç¨‹åºæ¡†æ¶
â”‚   â”‚   â”œâ”€â”€ etracee.h       # å…±äº«å¤´æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ execve_trace.c  # è¿›ç¨‹ç›‘æ§æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ filesystem_trace.c # æ–‡ä»¶ç³»ç»Ÿç›‘æ§æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ network_trace.c # ç½‘ç»œç›‘æ§æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ security_trace.c # å®‰å…¨äº‹ä»¶ç›‘æ§æ¨¡å—
â”‚   â”‚   â””â”€â”€ vmlinux.h       # å†…æ ¸ç±»å‹å®šä¹‰ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”œâ”€â”€ go/                # Go ç”¨æˆ·æ€ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ main.go         # ä¸»ç¨‹åº
â”‚   â”‚   â”œâ”€â”€ dashboard.go    # å®æ—¶Dashboardæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ aggregator.go   # èšåˆç»Ÿè®¡æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ go.mod          # Go æ¨¡å—å®šä¹‰
â”‚   â”‚   â””â”€â”€ go.sum          # ä¾èµ–é”å®šæ–‡ä»¶
â”‚   â””â”€â”€ python/            # Python AI æ¨¡å—ï¼ˆç¬¬äºŒé˜¶æ®µå¼€å‘ï¼‰
â”œâ”€â”€ config/                # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â””â”€â”€ security_rules.yaml # å®‰å…¨è§„åˆ™é…ç½®
â”œâ”€â”€ docs/                  # æŠ€æœ¯æ–‡æ¡£
â”‚   â”œâ”€â”€ ARCHITECTURE.md     # ç³»ç»Ÿæ¶æ„æ–‡æ¡£
â”‚   â”œâ”€â”€ TECHNICAL_GUIDE.md  # æŠ€æœ¯å®ç°æŒ‡å—
â”‚   â””â”€â”€ *.pdf              # è¯¦ç»†æŠ€æœ¯æ–¹æ¡ˆ
â”œâ”€â”€ test/                  # æµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ scripts/
â”‚       â””â”€â”€ bpftrace_test.bt # åŠŸèƒ½éªŒè¯æµ‹è¯•
â”œâ”€â”€ build/                 # æ„å»ºè¾“å‡ºç›®å½•
â”œâ”€â”€ bin/                   # äºŒè¿›åˆ¶æ–‡ä»¶ç›®å½•
â””â”€â”€ logs/                  # æ—¥å¿—ç›®å½•
```

## å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒæ­å»º

```bash
# ä»¥ root æƒé™è¿è¡Œç¯å¢ƒæ­å»ºè„šæœ¬
sudo ./setup.sh

# ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ
source /etc/profile
```

### 2. ç¼–è¯‘é¡¹ç›®

```bash
# æ£€æŸ¥ç¼–è¯‘ç¯å¢ƒ
make check-env

# ç¼–è¯‘æ‰€æœ‰ç»„ä»¶
make all
```

### 3. è¿è¡Œç¨‹åº

```bash
# åŸºç¡€ç›‘æ§æ¨¡å¼ï¼ˆJSONè¾“å‡ºï¼‰
sudo make run

# å¯ç”¨å®æ—¶Dashboardæ¨¡å¼
sudo ./bin/etracee -dashboard

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶
sudo ./bin/etracee -config config/security_rules.yaml -dashboard

# è¿‡æ»¤ç‰¹å®šPIDèŒƒå›´
sudo ./bin/etracee -pid-min 1000 -pid-max 65535 -dashboard

# è¿‡æ»¤ç‰¹å®šUIDèŒƒå›´
sudo ./bin/etracee -uid-min 1000 -uid-max 65535 -dashboard
```

### 4. DashboardåŠŸèƒ½è¯´æ˜

**å®æ—¶Dashboardç•Œé¢åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š**

- **åŸºç¡€ç»Ÿè®¡**: æ€»äº‹ä»¶æ•°ã€äº‹ä»¶å¤„ç†é€Ÿç‡ã€ç³»ç»Ÿè¿è¡Œæ—¶é—´
- **Topæ’è¡Œæ¦œ**: æœ€æ´»è·ƒçš„è¿›ç¨‹ã€ç³»ç»Ÿè°ƒç”¨ã€ç”¨æˆ·ç»Ÿè®¡
- **æœ€è¿‘äº‹ä»¶**: æœ€æ–°çš„å®‰å…¨äº‹ä»¶åˆ—è¡¨
- **å®‰å…¨å‘Šè­¦**: è§¦å‘å®‰å…¨è§„åˆ™çš„å‘Šè­¦ä¿¡æ¯
- **èšåˆç»Ÿè®¡**: æ—¶é—´çª—å£å†…çš„èšåˆæ•°æ®åˆ†æ
- **ç½‘ç»œå’Œæ–‡ä»¶**: ç½‘ç»œè¿æ¥å’Œæ–‡ä»¶æ“ä½œç»Ÿè®¡

**Dashboardå¿«æ·é”®ï¼š**
- `Ctrl+C`: ä¼˜é›…é€€å‡ºç¨‹åº
- ç•Œé¢æ¯ç§’è‡ªåŠ¨åˆ·æ–°

### 5. æµ‹è¯•éªŒè¯

eTracee æä¾›äº†å¤šç§æµ‹è¯•è„šæœ¬æ¥éªŒè¯åŠŸèƒ½ï¼š

#### ä¸»æµ‹è¯•è„šæœ¬
```bash
# è¿è¡Œä¸»æµ‹è¯•èœå•ï¼ˆæ¨èï¼‰
sudo ./test.sh
```

#### å…·ä½“æµ‹è¯•è„šæœ¬

**å¿«é€Ÿæµ‹è¯•**
```bash
# åŸºæœ¬åŠŸèƒ½éªŒè¯ï¼Œé€‚åˆå¿«é€Ÿæ£€æŸ¥
sudo ./scripts/quick_test.sh
```

**ä¿®å¤éªŒè¯æµ‹è¯•**
```bash
# éªŒè¯PID/UIDè¿‡æ»¤åŠŸèƒ½å’Œæ–°å¢å‚æ•°
sudo ./scripts/verify_fixes.sh
```

**å®Œæ•´åŠŸèƒ½æµ‹è¯•**
```bash
# å…¨é¢çš„åŠŸèƒ½æµ‹è¯•ï¼ŒåŒ…æ‹¬æ€§èƒ½å’Œå®‰å…¨è§„åˆ™
sudo ./scripts/test_functionality.sh
```

#### æ‰‹åŠ¨æµ‹è¯•
```bash
# è¿è¡Œ bpftrace æµ‹è¯•
sudo make test-bpftrace

# æˆ–è€…æ‰‹åŠ¨è¿è¡Œæµ‹è¯•è„šæœ¬
sudo bpftrace test/bpftrace_test.bt
```

#### æµ‹è¯•è„šæœ¬è¯´æ˜

| è„šæœ¬ | åŠŸèƒ½ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| `test.sh` | ä¸»æµ‹è¯•èœå• | äº¤äº’å¼é€‰æ‹©æµ‹è¯•ç±»å‹ |
| `quick_test.sh` | å¿«é€ŸéªŒè¯ | åŸºæœ¬åŠŸèƒ½æ£€æŸ¥ |
| `verify_fixes.sh` | ä¿®å¤éªŒè¯ | éªŒè¯å‚æ•°è¿‡æ»¤åŠŸèƒ½ |
| `test_functionality.sh` | å®Œæ•´æµ‹è¯• | å…¨é¢åŠŸèƒ½éªŒè¯ |

## æŠ€æœ¯ç‰¹æ€§

### eBPF ç¨‹åºç‰¹æ€§
- **CO-RE å…¼å®¹æ€§**: ä¸€æ¬¡ç¼–è¯‘ï¼Œè·¨å†…æ ¸ç‰ˆæœ¬è¿è¡Œ
- **é«˜æ•ˆæ•°æ®ä¼ è¾“**: Ring Buffer æœºåˆ¶ï¼Œä½å»¶è¿Ÿ
- **ç²¾ç¡®äº‹ä»¶æ•è·**: æ•è· PIDã€PPIDã€UIDã€GIDã€å‘½ä»¤åç­‰å…³é”®ä¿¡æ¯
- **æ™ºèƒ½è¿‡æ»¤**: æ”¯æŒè¿›ç¨‹çº§åˆ«çš„äº‹ä»¶è¿‡æ»¤

### ç”¨æˆ·æ€ç¨‹åºç‰¹æ€§
- **å®æ—¶å¤„ç†**: å¼‚æ­¥äº‹ä»¶å¤„ç†ï¼Œé«˜ååé‡
- **JSON è¾“å‡º**: ç»“æ„åŒ–æ•°æ®æ ¼å¼ï¼Œä¾¿äºåç»­å¤„ç†
- **æ—¶é—´æˆ³è½¬æ¢**: çº³ç§’ç²¾åº¦æ—¶é—´æˆ³å’Œäººç±»å¯è¯»æ—¶é—´
- **ä¼˜é›…é€€å‡º**: ä¿¡å·å¤„ç†å’Œèµ„æºæ¸…ç†

## ç›‘æ§çš„ç³»ç»Ÿè°ƒç”¨

| ç³»ç»Ÿè°ƒç”¨ | æè¿° | å®‰å…¨æ„ä¹‰ |
|---------|------|----------|
| execve | ç¨‹åºæ‰§è¡Œ | æ£€æµ‹æ¶æ„ç¨‹åºå¯åŠ¨ |
| openat | æ–‡ä»¶æ‰“å¼€ | ç›‘æ§æ•æ„Ÿæ–‡ä»¶è®¿é—® |
| connect | ç½‘ç»œè¿æ¥ | å‘ç°å¼‚å¸¸ç½‘ç»œè¡Œä¸º |
| exit | è¿›ç¨‹é€€å‡º | è·Ÿè¸ªè¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ |

## è¾“å‡ºæ ¼å¼ç¤ºä¾‹

```json
{
  "timestamp": "1703123456789012345",
  "pid": 1234,
  "ppid": 1000,
  "uid": 0,
  "gid": 0,
  "syscall_id": 59,
  "type": "execve",
  "comm": "bash",
  "filename": "/bin/ls",
  "human_time": "2023-12-21 10:30:56.789"
}
```

## å¼€å‘è®¡åˆ’

### âœ… ç¬¬ä¸€å‘¨ï¼šæ ¸å¿ƒç›‘æ§ç³»ç»Ÿï¼ˆå·²å®Œæˆï¼‰
- [x] æ¨¡å—åŒ–eBPFå†…æ ¸ç¨‹åºè®¾è®¡ä¸å®ç°
- [x] é«˜æ€§èƒ½ç”¨æˆ·æ€äº‹ä»¶å¤„ç†ç¨‹åº
- [x] æ™ºèƒ½å®‰å…¨è§„åˆ™å¼•æ“
- [x] å®Œæ•´çš„æ„å»ºå’Œæµ‹è¯•ç³»ç»Ÿ

### âœ… ç¬¬ä¸‰å‘¨ï¼šå®æ—¶Dashboardå’Œèšåˆç»Ÿè®¡ï¼ˆå·²å®Œæˆ - 100%ï¼‰
- [x] å‘½ä»¤è¡Œå®æ—¶Dashboardç•Œé¢ âœ… **å®Œå…¨å®ç°**
- [x] å¤šç»´åº¦äº‹ä»¶èšåˆç»Ÿè®¡ç³»ç»Ÿ âœ… **å®Œå…¨å®ç°**
- [x] å®‰å…¨å‘Šè­¦å’Œç½‘ç»œè¿æ¥ç»Ÿè®¡ âœ… **å®Œå…¨å®ç°**
- [x] Top Næ’è¡Œæ¦œå’Œæ—¶é—´çª—å£åˆ†æ âœ… **å®Œå…¨å®ç°**
- [x] PID/UIDäº‹ä»¶è¿‡æ»¤åŠŸèƒ½ âœ… **æ–°å¢å®Œæˆ**
- [x] å‘½ä»¤è¡Œå‚æ•°ç³»ç»Ÿå®Œå–„ âœ… **ä¿®å¤å®Œæˆ**
- [x] å…¨é¢æµ‹è¯•æ¡†æ¶å»ºè®¾ âœ… **æ–°å¢å®Œæˆ**
- [x] æ•…éšœæ’é™¤æ–‡æ¡£å®Œå–„ âœ… **æ–°å¢å®Œæˆ**

**ç¬¬ä¸‰å‘¨æˆæœæ€»ç»“:**
- ğŸ¯ **æ ¸å¿ƒç›®æ ‡**: 100% å®Œæˆï¼Œæ‰€æœ‰Dashboardå’Œç»Ÿè®¡åŠŸèƒ½æ­£å¸¸è¿è¡Œ
- ğŸ”§ **é¢å¤–ä¿®å¤**: è§£å†³äº†å‚æ•°å®šä¹‰é—®é¢˜ï¼Œå®ç°äº†å®Œæ•´çš„è¿‡æ»¤åŠŸèƒ½
- ğŸ§ª **æµ‹è¯•è¦†ç›–**: åˆ›å»ºäº†4å¥—æµ‹è¯•è„šæœ¬ï¼Œè¦†ç›–æ‰€æœ‰åŠŸèƒ½æ¨¡å—
- ğŸ“š **æ–‡æ¡£å®Œå–„**: æ›´æ–°äº†ä½¿ç”¨è¯´æ˜ã€æ•…éšœæ’é™¤å’Œè°ƒè¯•æŒ‡å—
- âœ… **è´¨é‡ä¿è¯**: æ‰€æœ‰åŠŸèƒ½ç»è¿‡å…¨é¢æµ‹è¯•éªŒè¯ï¼Œè¿è¡Œç¨³å®š

### ğŸš§ ç¬¬å››å‘¨è®¡åˆ’ï¼šAIæ£€æµ‹å’Œå¯è§†åŒ–ä¼˜åŒ–
- [ ] è½»é‡çº§AIå¼‚å¸¸æ£€æµ‹ç®—æ³•é›†æˆ
- [ ] Webç•Œé¢å¯è§†åŒ–Dashboard
- [ ] æ”»å‡»é“¾å…³è”åˆ†æå’Œå›¾è°±å±•ç¤º
- [ ] è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ
- [ ] æ€§èƒ½ä¼˜åŒ–å’Œå‹åŠ›æµ‹è¯•
- [ ] å®Œæ•´çš„æ–‡æ¡£å’Œéƒ¨ç½²æŒ‡å—

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æƒé™é—®é¢˜
```bash
# é—®é¢˜ï¼šPermission denied æˆ–éœ€è¦ root æƒé™
# è§£å†³ï¼šç¡®ä¿ä»¥ root æƒé™è¿è¡Œ
sudo ./bin/etracee
sudo ./test.sh
```

#### 2. ç¼–è¯‘é—®é¢˜
```bash
# é—®é¢˜ï¼šç¼–è¯‘å¤±è´¥æˆ–æ‰¾ä¸åˆ°å¯æ‰§è¡Œæ–‡ä»¶
# è§£å†³ï¼šé‡æ–°ç¼–è¯‘
make clean
make

# æ£€æŸ¥ä¾èµ–
sudo ./scripts/setup.sh
```

#### 3. å‚æ•°é—®é¢˜
```bash
# é—®é¢˜ï¼šflag provided but not defined: -uid-min
# è§£å†³ï¼šç¡®ä¿ä½¿ç”¨æœ€æ–°ç¼–è¯‘çš„ç‰ˆæœ¬
make clean && make

# éªŒè¯å‚æ•°æ”¯æŒ
./bin/etracee -h
```

#### 4. å†…æ ¸å…¼å®¹æ€§
```bash
# é—®é¢˜ï¼šå†…æ ¸ä¸æ”¯æŒ BTF æˆ– eBPF
# æ£€æŸ¥ BTF æ”¯æŒ
ls /sys/kernel/btf/vmlinux

# æ£€æŸ¥ eBPF æ”¯æŒ
sudo bpftool prog list
```

#### 5. Dashboard æ˜¾ç¤ºé—®é¢˜
```bash
# é—®é¢˜ï¼šDashboard ç•Œé¢æ˜¾ç¤ºå¼‚å¸¸
# è§£å†³ï¼šæ£€æŸ¥ç»ˆç«¯æ”¯æŒ
echo $TERM
export TERM=xterm-256color

# è°ƒæ•´ç»ˆç«¯å¤§å°
resize
```

#### 6. äº‹ä»¶æ•è·é—®é¢˜
```bash
# é—®é¢˜ï¼šæ²¡æœ‰æ•è·åˆ°äº‹ä»¶
# è§£å†³ï¼šæ£€æŸ¥ç³»ç»Ÿæ´»åŠ¨å’Œè¿‡æ»¤æ¡ä»¶
# ç”Ÿæˆæµ‹è¯•æ´»åŠ¨
ls /tmp
echo "test" > /tmp/test_file
rm /tmp/test_file

# æ£€æŸ¥è¿‡æ»¤å‚æ•°æ˜¯å¦è¿‡äºä¸¥æ ¼
sudo ./bin/etracee  # ä¸ä½¿ç”¨è¿‡æ»¤å‚æ•°æµ‹è¯•
```

#### 7. æ€§èƒ½é—®é¢˜
```bash
# é—®é¢˜ï¼šç³»ç»Ÿè´Ÿè½½è¿‡é«˜
# è§£å†³ï¼šè°ƒæ•´ç›‘æ§èŒƒå›´
sudo ./bin/etracee -uid-min 1000  # åªç›‘æ§æ™®é€šç”¨æˆ·
sudo ./bin/etracee -pid-min 1000  # åªç›‘æ§ç‰¹å®šPIDèŒƒå›´
```

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
# è¾“å‡ºåˆ°æ–‡ä»¶è¿›è¡Œåˆ†æ
sudo ./bin/etracee > debug.log 2>&1

# ä½¿ç”¨ strace è°ƒè¯•
sudo strace -o strace.log ./bin/etracee
```

#### æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
```bash
# æ£€æŸ¥ eBPF ç¨‹åºçŠ¶æ€
sudo bpftool prog list | grep etracee

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
sudo bpftool map list | grep etracee

# æ£€æŸ¥ç³»ç»Ÿèµ„æº
top -p $(pgrep etracee)
```

#### æµ‹è¯•ç¯å¢ƒéªŒè¯
```bash
# è¿è¡Œå®Œæ•´è¯Šæ–­
sudo ./scripts/verify_fixes.sh

# æ£€æŸ¥ä¾èµ–å®Œæ•´æ€§
ldd ./bin/etracee
```

### è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯**ï¼š`./bin/etracee -h`
2. **è¿è¡Œæµ‹è¯•è„šæœ¬**ï¼š`sudo ./test.sh`
3. **æ£€æŸ¥æ—¥å¿—æ–‡ä»¶**ï¼šæŸ¥çœ‹ `/tmp/` ç›®å½•ä¸‹çš„æµ‹è¯•æ—¥å¿—
4. **æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—**ï¼š`dmesg | grep -i bpf`

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ· Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ GPL è®¸å¯è¯ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issue æˆ–è”ç³»å¼€å‘å›¢é˜Ÿã€‚